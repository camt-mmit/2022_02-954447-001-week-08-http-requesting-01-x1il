"use strict";(self.webpackChunkmy_sw=self.webpackChunkmy_sw||[]).push([[578],{3578:(ye,b,a)=>{a.r(b),a.d(b,{routes:()=>ve});var c=a(6895),R=a(5698),n=a(8274),l=a(5861),O=a(9635),f=a(3900),p=a(2076),Y=a(1135),N=a(727);class B extends N.w0{constructor(e,t){super()}schedule(e,t=0){return this}}const C={setInterval(s,e,...t){const{delegate:o}=C;return o?.setInterval?o.setInterval(s,e,...t):setInterval(s,e,...t)},clearInterval(s){const{delegate:e}=C;return(e?.clearInterval||clearInterval)(s)},delegate:void 0};var M=a(8737);const z={now:()=>(z.delegate||Date).now(),delegate:void 0};class m{constructor(e,t=m.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,o){return new this.schedulerActionCtor(this,e).schedule(o,t)}}m.now=z.now;const K=new class J extends m{constructor(e,t=m.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let o;this._active=!0;do{if(o=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,o){for(;e=t.shift();)e.unsubscribe();throw o}}}(class Q extends B{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var o;if(this.closed)return this;this.state=e;const r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(o=this.id)&&void 0!==o?o:this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,o=0){return C.setInterval(e.flush.bind(e,this),o)}recycleAsyncId(e,t,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return t;null!=t&&C.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(e,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r,o=!1;try{this.work(e)}catch(i){o=!0,r=i||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:o}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,M.P)(o,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}});var F=a(4482),I=a(5403),H=a(4671);function V(s,e){return s===e}var U=a(2843),L=a(9646),y=a(4004),W=a(3099),k=a(8959);function _(s){const e=new Uint32Array(s/2);return crypto.getRandomValues(e),Array.from(e,t=>("0"+t.toString(16)).slice(-2)).join("")}function E(){return(E=(0,l.Z)(function*(s){const t=(new TextEncoder).encode(s);return crypto.subtle.digest("SHA-256",t)})).apply(this,arguments)}var $=a(529),u=a(3889);const j="https://oauth2.googleapis.com/token",P="google-token",Z="google-state-";class h{constructor(e,t,o,r){this.configuration=e,this.storage=t,this.http=o,this.router=r,this.storeTokenDataPipe=(0,O.z)((0,f.w)(i=>(0,p.D)(this.storeTokenData(i)))),this.tokenReadySubject=new Y.X(null),this.tokenRead$=this.tokenReadySubject.asObservable().pipe(function q(s,e=K){return(0,F.e)((t,o)=>{let r=null,i=null,d=null;const S=()=>{if(r){r.unsubscribe(),r=null;const v=i;i=null,o.next(v)}};function me(){const v=d+s,G=e.now();if(G<v)return r=this.schedule(void 0,v-G),void o.add(r);S()}t.subscribe((0,I.x)(o,v=>{i=v,d=e.now(),r||(r=e.schedule(me,s),o.add(r))},()=>{S(),o.complete()},void 0,()=>{i=r=null}))})}(100),function X(s,e=H.y){return s=s??V,(0,F.e)((t,o)=>{let r,i=!0;t.subscribe((0,I.x)(o,d=>{const S=e(d);(i||!s(r,S))&&(i=!1,r=S,o.next(d))}))})}()),this.getAvailbleTokenData().then(i=>{console.debug(i),null===this.tokenReadySubject.value&&this.tokenReadySubject.next("none"!==i.type)})}storeTokenData(e){var t=this;return(0,l.Z)(function*(){const o=Date.now(),r={...e},i=yield t.loadTokenData();return!r.refresh_token&&i?.refresh_token&&(r.refresh_token=i.refresh_token),void 0===r.expiredAt&&(r.expiredAt=o+1e3*r.expires_in-1e4),yield t.storage.storeData(P,r),t.tokenReadySubject.next(!0),r})()}loadTokenData(){var e=this;return(0,l.Z)(function*(){return e.storage.loadData(P)})()}removeTokenData(){var e=this;return(0,l.Z)(function*(){yield e.storage.removeData(P),e.tokenReadySubject.next(!1)})()}storeState(e,t){var o=this;return(0,l.Z)(function*(){const r=Date.now(),i={...t};return void 0===i.expiredAt&&(i.expiredAt=r+6e5),yield o.storage.storeData(`${Z}${e}`,i),i})()}loadState(e){var t=this;return(0,l.Z)(function*(){const o=Date.now();for(const r of yield t.storage.loadKeys())console.debug(r),r.startsWith(Z)&&((yield t.storage.loadData(r))?.expiredAt??0)<o&&(yield t.storage.removeData(r));return console.debug(e),t.storage.loadData(`${Z}${e}`)})()}removestate(e){var t=this;return(0,l.Z)(function*(){const o=yield t.loadState(e);return console.debug(o),yield t.storage.removeData(`${Z}${e}`),o})()}refreshTokenData(e){return this.http.post(j,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:e}).pipe(this.storeTokenDataPipe)}exchangeCodeForToken(e,t,o){return(0,p.D)(this.removestate(t)).pipe((0,f.w)(r=>o?(0,U._)(()=>o):(0,L.of)(r)),(0,f.w)(r=>r?this.http.post(j,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:e,code_verifier:r.verifierCode,grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe(this.storeTokenDataPipe,(0,y.U)(()=>r)):(0,U._)(()=>new k.YP(t))))}getAuthorizationURL(){const e=_(56);return(0,p.D)(function ne(s){return E.apply(this,arguments)}(e)).pipe((0,y.U)(t=>function ee(s,e=!1){let t="";const o=new Uint8Array(s),r=o.byteLength;for(let d=0;d<r;d++)t+=String.fromCharCode(o[d]);const i=btoa(t);return e?function te(s){return s.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(i):i}(t,!0)),(0,f.w)(t=>{const o=_(16);return(0,p.D)(this.storeState(o,{verifierCode:e,redirectUrl:this.router.url})).pipe((0,y.U)(()=>({challengeCode:t,securityToken:o})))}),(0,y.U)(({challengeCode:t,securityToken:o})=>{const r=new URL("https://accounts.google.com/o/oauth2/v2/auth");return r.searchParams.set("client_id",this.configuration.client_id),r.searchParams.set("redirect_uri",this.configuration.redirect_uri),r.searchParams.set("response_type","code"),r.searchParams.set("scope",this.configuration.scopes.join(" ")),r.searchParams.set("code_challenge",t),r.searchParams.set("code_challenge_method","S256"),r.searchParams.set("state",new URLSearchParams({security_token:o}).toString()),r.searchParams.append("prompt","consent"),r.searchParams.append("access_type","offline"),r}))}getAvailbleTokenData(){var e=this;return(0,l.Z)(function*(){const t=yield e.loadTokenData(),o=Date.now();if(t){if(console.debug(t,t.expiredAt,t.expiredAt??0,(t.expiredAt??0)>o),(t.expiredAt??0)>o)return{type:"allowed",tokenData:t};if(t.refresh_token)return{type:"refresh",refreshToken:t.refresh_token}}return{type:"none"}})()}tryLoadingTokenData(){return(0,p.D)(this.getAvailbleTokenData()).pipe((0,f.w)(e=>"none"===e.type?(0,L.of)(null):"allowed"===e.type?(0,L.of)(e.tokenData):this.refreshTokenData(e.refreshToken)),(0,W.B)())}getAccessToken(){return(0,p.D)(this.tryLoadingTokenData()).pipe((0,y.U)(e=>e?.access_token??null))}getAuthorizationHeader(){return(0,p.D)(this.tryLoadingTokenData()).pipe((0,f.w)(e=>e?(0,L.of)(`${e.token_type} ${e.access_token}`):(0,U._)(()=>new k.kG)))}forceExpired(){var e=this;return(0,l.Z)(function*(){const t=yield e.loadTokenData();t&&(t.expiredAt=0)})()}deleteToken(){var e=this;return(0,l.Z)(function*(){return e.removeTokenData()})()}}h.\u0275fac=function(e){return new(e||h)(n.LFG(k.tL),n.LFG(k.M3),n.LFG($.eN),n.LFG(u.F0))},h.\u0275prov=n.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"});class T{constructor(e,t,o){this.tokenService=e,this.route=t,this.router=o,this.errorMessage=null}ngOnInit(){console.debug("xxxxx");const e=this.route.snapshot.queryParams,t=e.code,o=new URLSearchParams(e.state).get("security_token");t&&o&&this.tokenService.exchangeCodeForToken(t,o,e.error).pipe((0,R.q)(1)).subscribe({next:r=>{this.router.navigateByUrl(r.redirectUrl)},error:r=>{this.errorMessage=r.error?.error?r.error?.error:r instanceof Error?r.message:r}})}}function ce(s,e){if(1&s&&(n.TgZ(0,"div")(1,"div"),n._uU(2),n.qZA(),n.TgZ(3,"div"),n._uU(4),n.qZA()()),2&s){const t=e.$implicit,o=n.oxw();n.xp6(2),n.Oqu(t.summary),n.xp6(2),n.Oqu(o.displayEventTimeRange(t))}}T.\u0275fac=function(e){return new(e||T)(n.Y36(h),n.Y36(u.gz),n.Y36(u.F0))},T.\u0275cmp=n.Xpm({type:T,selectors:[["google-authorization-pag"]],standalone:!0,features:[n.jDz],decls:2,vars:1,template:function(e,t){1&e&&(n.TgZ(0,"p"),n._uU(1),n.qZA()),2&e&&(n.xp6(1),n.Oqu(t.errorMessage))},dependencies:[c.ez]});class x{constructor(){this.displayEventTimeRange=k.sr}ngOnInit(){if(!this.data)throw new Error("Property 'data' is required")}}x.\u0275fac=function(e){return new(e||x)},x.\u0275cmp=n.Xpm({type:x,selectors:[["google-events-list"]],inputs:{data:"data"},standalone:!0,features:[n.jDz],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&n.YNc(0,ce,5,2,"div",0),2&e&&n.Q6J("ngForOf",t.data.items)},dependencies:[c.ez,c.sg]});var le=a(8505);class g{constructor(e,t){this.tokenService=e,this.http=t}getAll(e){return console.debug("getAll"),this.tokenService.getAuthorizationHeader().pipe((0,f.w)(t=>this.http.get("https://www.googleapis.com/calendar/v3/calendars/primary/events",{headers:{authorization:t},params:e})))}}function de(s,e){1&s&&n._UZ(0,"google-events-list",2),2&s&&n.Q6J("data",e.ngIf)}function he(s,e){1&s&&(n.TgZ(0,"div"),n._uU(1," loading... "),n.qZA())}g.\u0275fac=function(e){return new(e||g)(n.LFG(h),n.LFG($.eN))},g.\u0275prov=n.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"});class A{constructor(e){this.dataService=e,this.data$=this.dataService.getAll().pipe((0,le.b)(t=>console.debug("xxxxxx",t)))}}A.\u0275fac=function(e){return new(e||A)(n.Y36(g))},A.\u0275cmp=n.Xpm({type:A,selectors:[["google-events-list-page"]],standalone:!0,features:[n.jDz],decls:4,vars:4,consts:[[3,"data",4,"ngIf","ngIfElse"],["loading",""],[3,"data"]],template:function(e,t){if(1&e&&(n.YNc(0,de,1,1,"google-events-list",0),n.ALo(1,"async"),n.YNc(2,he,2,0,"ng-template",null,1,n.W1O)),2&e){const o=n.MAs(3);n.Q6J("ngIf",n.lcZ(1,2,t.data$))("ngIfElse",o)}},dependencies:[c.ez,c.O5,c.Ov,x]});class D{}function fe(s,e){if(1&s){const t=n.EpF();n.ynx(0),n.TgZ(1,"div")(2,"button",3),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.onForceExpired)}),n._uU(3," Force Expired "),n.qZA(),n.TgZ(4,"button",4),n._uU(5," Delete Token "),n.qZA()(),n._UZ(6,"router-outlet"),n.BQk()}}function pe(s,e){if(1&s){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",3),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.onLogin())}),n._uU(2,"Login to Goole"),n.qZA(),n.BQk()}}function ge(s,e){1&s&&(n.TgZ(0,"div"),n._uU(1,"Loading..."),n.qZA())}D.\u0275fac=function(e){return new(e||D)},D.\u0275cmp=n.Xpm({type:D,selectors:[["google-root"]],standalone:!0,features:[n.jDz],decls:6,vars:0,consts:[[1,"cmp-"],["href","","routerLink","events","routerLinkActive","st-active"]],template:function(e,t){1&e&&(n.TgZ(0,"nav")(1,"ul",0)(2,"li")(3,"a",1),n._uU(4,"Evensts"),n.qZA()()()(),n._UZ(5,"router-outlet"))},dependencies:[c.ez,u.Bz,u.lC,u.rH,u.Od]});class w{constructor(e){this.tokenSerivce=e,this.tokenReady$=this.tokenSerivce.tokenRead$}onForceExpired(){var e=this;return(0,l.Z)(function*(){return e.tokenSerivce.forceExpired()})()}onLogin(){this.tokenSerivce.getAuthorizationURL().pipe((0,R.q)(1)).subscribe(e=>{console.debug(e),location.href=`${e}`})}}w.\u0275fac=function(e){return new(e||w)(n.Y36(h))},w.\u0275cmp=n.Xpm({type:w,selectors:[["google-require-token"]],standalone:!0,features:[n.jDz],decls:5,vars:5,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["type","button",3,"click"],["type","button"]],template:function(e,t){1&e&&(n.ynx(0,0),n.ALo(1,"async"),n.YNc(2,fe,7,0,"ng-container",1),n.YNc(3,pe,3,0,"ng-container",1),n.YNc(4,ge,2,0,"div",2),n.BQk()),2&e&&(n.Q6J("ngSwitch",n.lcZ(1,3,t.tokenReady$)),n.xp6(2),n.Q6J("ngSwitchCase",!0),n.xp6(1),n.Q6J("ngSwitchCase",!1))},dependencies:[c.ez,c.RF,c.n9,c.ED,c.Ov,u.Bz,u.lC]});const ve=[{path:"",component:D,children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"",component:w,children:[{path:"events",component:A}]},{path:"authorization",component:T}]}]}}]);